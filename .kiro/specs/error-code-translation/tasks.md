# 接口错误码转换实现计划

- [x] 1. 创建 API 响应拦截器

  - 在 axios 配置中添加响应拦截器
  - 实现错误响应的统一捕获机制
  - 建立错误信息提取逻辑
  - _需求: 1.5, 2.5, 3.5, 4.5_

- [ ] 2. 实现错误码转换器

  - [x] 2.1 创建 ErrorCodeTranslator 类

    - 编写登录错误的转换逻辑（401 状态码处理）
    - 实现网络错误的转换方法（500、503 等状态码）
    - 创建表单验证错误转换（400、409、422 状态码）
    - 添加业务逻辑错误转换（403、404、429 状态码）
    - _需求: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 2.4, 3.1, 3.2, 3.3, 3.4, 4.1, 4.2, 4.3, 4.4_

  - [x] 2.2 建立错误码映射表

    - 创建登录相关错误码到友好消息的映射
    - 定义网络错误类型到用户提示的映射
    - 建立表单验证错误的详细映射表
    - 添加业务逻辑错误的转换规则
    - _需求: 1.1, 1.2, 1.3, 1.4, 2.1, 2.2, 2.3, 2.4, 3.1, 3.2, 3.3, 3.4, 4.1, 4.2, 4.3, 4.4_

- [x] 3. 集成到登录页面


  - [x] 3.1 修改登录页面错误处理

    - 移除现有的技术错误码显示逻辑
    - 集成 ErrorCodeTranslator 到登录流程
    - 确保密码错误、用户不存在等场景显示正确消息
    - 验证 401 错误码完全隐藏，只显示友好消息
    - _需求: 1.1, 1.2, 1.3, 1.4, 1.5_

  - [x] 3.2 优化登录错误显示

    - 根据具体错误类型调整显示样式
    - 为不同错误提供相应的解决建议
    - 确保错误消息的一致性和专业性
    - _需求: 1.1, 1.2, 1.3, 1.4_

- [ ] 4. 集成到注册页面

  - [ ] 4.1 修改注册页面错误处理

    - 应用 ErrorCodeTranslator 到注册流程
    - 处理邮箱重复（409 错误）的友好提示
    - 优化表单验证错误（400、422 错误）的显示
    - 隐藏所有技术状态码，只显示用户友好消息
    - _需求: 3.1, 3.2, 3.3, 3.4, 3.5_

  - [ ] 4.2 实现注册特定错误处理
    - 添加邮箱格式错误的具体提示
    - 实现密码格式要求的详细说明
    - 优化注册信息不完整的错误提示
    - _需求: 3.1, 3.2, 3.3, 3.4_

- [ ] 5. 创建全局错误处理机制

  - [ ] 5.1 实现全局 API 错误拦截

    - 在 API 配置文件中集成错误转换器
    - 建立统一的错误处理入口点
    - 确保所有 API 调用都经过错误码转换
    - _需求: 2.5, 4.5_

  - [ ] 5.2 添加网络错误处理
    - 实现网络连接失败的友好提示
    - 处理服务器超时的用户友好消息
    - 添加服务不可用的明确说明
    - 隐藏所有网络相关的技术错误码
    - _需求: 2.1, 2.2, 2.3, 2.4, 2.5_

- [ ] 6. 实现业务错误处理

  - [ ] 6.1 添加权限相关错误处理

    - 处理 403 权限不足错误的友好提示
    - 实现 404 资源不存在的用户友好消息
    - 添加 429 频率限制的明确说明
    - _需求: 4.1, 4.2, 4.3, 4.4_

  - [ ] 6.2 优化业务错误显示
    - 根据业务场景提供具体的解决建议
    - 确保业务错误消息的准确性和指导性
    - 建立业务错误的统一显示风格
    - _需求: 4.5_

- [ ] 7. 编写单元测试

  - [ ] 7.1 测试错误码转换功能

    - 编写登录错误转换的单元测试
    - 测试网络错误转换的准确性
    - 验证表单验证错误转换的正确性
    - 测试业务逻辑错误转换的完整性
    - _需求: 1.1-1.5, 2.1-2.5, 3.1-3.5, 4.1-4.5_

  - [ ] 7.2 测试技术术语隐藏
    - 验证所有状态码都被正确隐藏
    - 测试技术错误消息的完全过滤
    - 确认用户界面不显示任何技术术语
    - _需求: 1.5, 2.5, 3.5, 4.5_

- [ ] 8. 进行集成测试

  - [ ] 8.1 测试完整的错误处理流程

    - 模拟各种登录失败场景并验证错误消息
    - 测试网络异常情况下的错误显示
    - 验证表单验证错误的完整流程
    - 测试业务逻辑错误的处理效果
    - _需求: 1.1-1.5, 2.1-2.5, 3.1-3.5, 4.1-4.5_

  - [ ] 8.2 验证用户体验
    - 确认用户能够理解所有错误消息
    - 验证错误消息提供了有效的解决建议
    - 测试错误显示的时机和方式是否合适
    - _需求: 1.1-1.5, 2.1-2.5, 3.1-3.5, 4.1-4.5_

- [ ] 9. 性能优化和最终验证

  - [ ] 9.1 优化错误处理性能

    - 确保错误转换不影响 API 响应速度
    - 优化错误码映射表的查询效率
    - 验证错误处理的内存使用情况
    - _需求: 所有需求的性能要求_

  - [ ] 9.2 最终用户验证
    - 进行完整的用户场景测试
    - 验证所有错误码都已转换为友好消息
    - 确认用户能够根据错误提示解决问题
    - 进行最终的用户体验优化
    - _需求: 1.1-1.5, 2.1-2.5, 3.1-3.5, 4.1-4.5_
