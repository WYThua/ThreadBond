# 接口错误码转换设计文档

## 概述

接口错误码转换系统负责将后端返回的技术性错误码转换为用户友好的错误消息。系统采用拦截器模式，在API响应阶段统一处理错误转换，确保用户永远不会看到技术错误码。

## 架构

### 错误转换流程

```
API请求 → 后端响应 → 响应拦截器 → 错误码识别 → 消息转换 → 用户界面显示
```

## 组件和接口

### 1. API响应拦截器 (ResponseInterceptor)

**职责：** 拦截所有API响应，识别错误状态码

**接口：**
```javascript
class ResponseInterceptor {
  // 处理成功响应
  handleSuccess(response)
  
  // 处理错误响应
  handleError(error)
  
  // 提取错误信息
  extractErrorInfo(error)
}
```

### 2. 错误码转换器 (ErrorCodeTranslator)

**职责：** 将错误码转换为用户友好消息

**接口：**
```javascript
class ErrorCodeTranslator {
  // 转换登录相关错误
  translateLoginError(statusCode, message, context)
  
  // 转换网络相关错误
  translateNetworkError(error)
  
  // 转换表单验证错误
  translateValidationError(statusCode, fieldErrors)
  
  // 转换业务逻辑错误
  translateBusinessError(statusCode, message)
}
```

## 数据模型

### 错误码映射表

```javascript
const ERROR_CODE_MAP = {
  // 登录相关错误
  login: {
    401: {
      'Invalid password': '密码错误，请重新输入',
      'User not found': '用户不存在，请检查邮箱地址',
      'Account disabled': '账户已被禁用，请联系客服',
      'default': '邮箱或密码错误，请检查后重试'
    }
  },
  
  // 网络相关错误
  network: {
    500: '服务器内部错误，请稍后重试',
    502: '服务器网关错误，请稍后重试',
    503: '服务暂时不可用，请稍后重试',
    504: '服务器响应超时，请稍后重试',
    'NETWORK_ERROR': '网络连接失败，请检查网络设置',
    'TIMEOUT': '服务器连接超时，请稍后重试'
  },
  
  // 表单验证错误
  validation: {
    400: {
      'email': '邮箱格式不正确',
      'password': '密码格式不符合要求',
      'default': '输入信息有误，请检查后重试'
    },
    409: '该邮箱已被注册',
    422: '输入信息不完整或格式错误'
  },
  
  // 业务逻辑错误
  business: {
    403: '权限不足，无法执行此操作',
    404: '请求的资源不存在',
    410: '请求的资源已过期',
    429: '操作过于频繁，请稍后再试'
  }
}
```

## 错误处理策略

### 1. 登录错误处理

| 状态码 | 后端消息 | 转换后消息 |
|--------|----------|-----------|
| 401 | "Invalid password" | "密码错误，请重新输入" |
| 401 | "User not found" | "用户不存在，请检查邮箱地址" |
| 401 | "Account disabled" | "账户已被禁用，请联系客服" |
| 401 | 其他或无消息 | "邮箱或密码错误，请检查后重试" |

### 2. 网络错误处理

| 错误类型 | 转换后消息 |
|----------|-----------|
| 网络连接失败 | "网络连接失败，请检查网络设置" |
| 请求超时 | "服务器连接超时，请稍后重试" |
| 500错误 | "服务器内部错误，请稍后重试" |
| 503错误 | "服务暂时不可用，请稍后重试" |

### 3. 表单验证错误处理

| 状态码 | 字段类型 | 转换后消息 |
|--------|----------|-----------|
| 400 | email | "邮箱格式不正确" |
| 400 | password | "密码格式不符合要求" |
| 409 | email重复 | "该邮箱已被注册" |
| 422 | 通用 | "输入信息不完整或格式错误" |

## 测试策略

### 1. 错误码转换测试
- 验证各种状态码的正确转换
- 测试消息匹配的准确性
- 确认技术术语的完全隐藏

### 2. 用户体验测试
- 验证错误消息的可读性
- 测试错误提示的指导性
- 确认用户能够理解错误原因

### 3. 边界情况测试
- 测试未知错误码的处理
- 验证网络异常的兜底处理
- 测试并发错误的处理能力